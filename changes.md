# Change Log

- Updated `.gitignore` to ignore workspace build artifacts and node modules for clean status.
- Declared `react-router-dom` as a peer dependency in `packages/ui/package.json` so shared components resolve router imports.
- Added matching dev dependencies in `packages/ui/package.json` to support local builds with `react-router-dom`.
- Introduced a post-signup welcome screen in `apps/senior-pwa/src/pages/Signup.jsx` and adjusted routing so the confirmation message appears before redirecting home.
- Added \checklist.md\ (backend root) listing every API endpoint for tracking coverage.

- Senior PWA now triggers /auth/logout on sign-out (updated apps/senior-pwa/src/services/auth.js, apps/senior-pwa/src/contexts/AuthContext.jsx, and apps/senior-pwa/src/pages/Home.jsx).

- Senior PWA auth module/context now support token refresh, `/users/me` hydration, and expiry-aware persistence.
- Senior PWA trails views now call live APIs for listings, registrations, and confirmed trails (new apps/senior-pwa/src/services/trails.js, updated apps/senior-pwa/src/pages/Home.jsx and apps/senior-pwa/src/pages/MyTrails.jsx).
- Trail detail, join/cancel UI, and registration status lookup added but backend session cleanup still unstable (in progress; see trails-activities-svc/app/db.py).
- Senior PWA trail detail page now memoizes its refresh handler without trail-state churn and tracks first-load with a ref, preventing the view from spamming `GET /users/me/registrations`/`GET /trails/:id` while open.
- Senior PWA scan experience now calls the QR check-in service for live scans, manual token entry, and history (`apps/senior-pwa/src/services/checkins.js`, `apps/senior-pwa/src/pages/Scan.jsx`, reusing `components/QRScanner.jsx`).
- Updated backend `checklist.md` to mark `GET /checkin/users/me` as implemented and note that `POST /checkin/scan` still needs end-to-end camera verification.
- Senior PWA rewards screen now fetches live points, vouchers, and redemption history via points service (new `src/services/points.js`, updated `src/pages/Rewards.jsx`).
- Updated checklist entries for points/voucher attendee APIs to "!" to indicate pending organiser-driven testing.
- Senior PWA now consumes leaderboard & attendance services (new `src/services/leaderboard.js`, updated `src/pages/Leaderboard.jsx` and `src/pages/MyTrails.jsx`).
- Added organiser dashboard auth context, organiser login page, and `organiserLogin` service consuming /auth/organisers/login.
- Added organiser test account (username admin) and marked /auth/organisers login/signup as implemented.
- Split API checklist into Senior PWA vs Organiser Dashboard sections with endpoint coverage.
- Reworked checklist into service-by-service matrix showing Senior PWA vs Organiser Dashboard coverage.
- Organiser dashboard auth context now refreshes tokens, hydrates profile via /users/me, and calls /auth/logout.
- Updated organiser UI button helper and layout to remove React warnings and hydration mismatches.
- Organizer dashboard Manage Trails view now consumes live Trails & Activities APIs for listing, creation, editing, attendee rosters, status workflows, manual enrolment, and invite minting.
- Manage Trails invite panel now displays the correct expiry timestamp by normalising server epoch seconds into ISO dates before rendering (`apps/organizer-dashboard/src/services/trails.ts`).
- Senior Scan view now recognises trail invite QR codes and redirects attendees to the Join flow instead of submitting them as check-ins (`apps/senior-pwa/src/pages/Scan.jsx`, `apps/senior-pwa/src/services/checkins.js`).
- Trails & Activities backend now respects requested initial status, restricts `/trails` listings to authenticated roles, and serves paginated attendee payloads (updated `app/routers/trails.py`, `app/schemas.py` plus new tests in `tests/test_trails_service.py`).
- Organiser dashboard trail services now understand paginated rosters and optional status on create (updated `apps/organizer-dashboard/src/services/trails.ts`).
- Manage Trails client adds paginated roster loading, richer metrics, invite copy polish, and reuses the new pagination helpers (`apps/organizer-dashboard/src/app/manageTrails/page.tsx`).
- Organizer dashboard now covers the remaining Trails & Activities interactions: trail detail hydration, attendee lookups, invite preview/acceptance, and organiser participation summaries (updated `apps/organizer-dashboard/src/services/trails.ts` and `apps/organizer-dashboard/src/app/manageTrails/page.tsx`).
- Added an organiser setup page that provisions accounts via a protected API route and lets signed-in staff create new organisations (`apps/organizer-dashboard/src/app/organisations/page.tsx`, `src/app/api/organiser-signup/route.ts`, `src/services/auth.ts`).
- Organiser dashboard now has client wrappers for leaderboard and attendance APIs, enabling system/org rankings and roster views (`apps/organizer-dashboard/src/services/leaderboard.ts`).
- Insights page now surfaces live system and organisation leaderboards plus per-trail attendance using the new services (`apps/organizer-dashboard/src/app/insights/page.tsx`).
- Senior PWA shows an organisation assignment banner for unassigned users and treats cancelled registrations as rejoinable (updated `apps/senior-pwa/src/pages/Home.jsx`, `MyTrails.jsx`, and `TrailDetail.jsx`).
- Organiser dashboard reuses NRIC lookups across attendee status checks and points adjustments, including participant context in results (`apps/organizer-dashboard/src/app/manageTrails/page.tsx`, `src/app/points/page.tsx`, `src/services/auth.ts`).
- Points dashboard now lists organisation-wide balances with search and pagination, powered by new client helpers (`apps/organizer-dashboard/src/app/points/page.tsx`, `src/services/points.ts`).
- Manage Trails roster and registration tables now surface participant names, NRICs, and IDs using a cached attendee directory, and related alerts reference friendly identifiers (`apps/organizer-dashboard/src/app/manageTrails/page.tsx`).
- Organizer dashboard navigation now links directly to the points workspace (`apps/organizer-dashboard/src/app/layout.tsx`).
- Points workspace now resolves participant names/NRICs for balances and ledger entries using the shared attendee directory cache (`apps/organizer-dashboard/src/app/points/page.tsx`).
- Organiser dashboard ledger view now surfaces organisation-wide transactions with participant IDs, error messaging, and load-more controls (apps/organizer-dashboard/src/app/points/page.tsx).
- Senior PWA auth context periodically re-fetches /users/me so new organisation assignments appear without a manual relog (apps/senior-pwa/src/contexts/AuthContext.jsx).
- Senior PWA home screen now lets seniors redeem organiser invite codes with live preview and trail enrollment (`apps/senior-pwa/src/services/trails.js`, `apps/senior-pwa/src/pages/Home.jsx`).
- Organizer insights page now includes an organisation picker so admins can view any org leaderboard while keeping attendance limited to org members (apps/organizer-dashboard/src/app/insights/page.tsx, src/services/auth.ts).
- Senior PWA adds a public `/join` QR invite scanner with pending invite storage and auto-accept after authentication (new `apps/senior-pwa/src/pages/Join.jsx`, `src/utils/pendingInvite.js`; updated `src/services/checkins.js`, `src/pages/Home.jsx`, `src/pages/Login.jsx`, `src/pages/Signup.jsx`, `App.jsx`).
- Fixed the senior invite auto-registration flow: login/signup now auto-consume pending tokens, store success/error status, and Home surfaces the outcome while refreshing data (`apps/senior-pwa/src/utils/pendingInvite.js`, `src/pages/Login.jsx`, `src/pages/Signup.jsx`, `src/pages/Home.jsx`).
- Organizer dashboard recent activities now fetch live trails and organisation names, replacing the placeholder cards with real-time data plus refresh/empty states (`apps/organizer-dashboard/src/app/page.tsx`).
- Dashboard Recent Activities now merges trail publications, registration approvals, and reward edits with clear labels by pulling new metadata from Trails and Points services (`apps/organizer-dashboard/src/app/page.tsx`, `src/services/trails.ts`, `src/services/points.ts`, `trails-activities-svc/app/{routers,schemas}.py`, `points-vouchers-rules-svc/app/{routers,schemas}.py`).
- Senior PWA rewards and scan pages now enforce organisation membership: attendees without an assignment see guidance cards, API calls are skipped, and the UI routes them to the Join flow instead of attempting rewards or QR scans (`apps/senior-pwa/src/pages/Rewards.jsx`, `src/pages/Scan.jsx`).
- QR check-in service now mints a service token to call the points ingest endpoint whenever NATS-based awarding is disabled, so attendance automatically grants points without organiser action (`qr-checkin-svc/app/core/config.py`, `app/services/auth_client.py`, `app/deps.py`, `.env`, `k8s/all.yaml`).
- Documented the backend requirements for scan-to-join and organiser bulk balance/leaderboard views so the flows can be enabled consistently (`docs/backend-support.md`).
- Organiser overview stats (participants, active members, activities, completion rate) now pull live counts from the auth/trails services with proper loading/error states (`apps/organizer-dashboard/src/app/page.tsx`).
- Added an organiser Rewards tab that lists organisation vouchers, lets admins create new rewards, and toggle voucher status without leaving the dashboard (`apps/organizer-dashboard/src/app/rewards/page.tsx`, `src/services/vouchers.ts`, `src/app/layout.tsx`).
- Restored separate Points and Rewards tabs so ledger management and voucher catalogues live on dedicated pages (`apps/organizer-dashboard/src/app/layout.tsx`, `src/app/points/page.tsx`, `src/app/rewards/page.tsx`).
- Documented why per-trail reward overrides are unavailable today and what backend work is required before implementing them (`docs/backend-support.md`).
- Organizer dashboard Insights now shows reporting cards (membership snapshot, attendance trends, trail overview, and points activity) powered by the new backend reporting endpoints (`apps/organizer-dashboard/src/app/insights/page.tsx`, `src/services/auth.ts`, `src/services/leaderboard.ts`, `src/services/points.ts`, `src/services/trails.ts`).
- Organizer overview page now uses deterministic date/number formatters so SSR markup matches the client tree, eliminating the hydration mismatch error (`apps/organizer-dashboard/src/app/page.tsx`).
- Manage Trails, Participants, Points, and Insights now render participant name + NRIC + short ID via a shared formatter, replacing the plain UUIDs in attendee rosters, balance tables, leaderboards, and ledger rows (`apps/organizer-dashboard/src/app/manageTrails/page.tsx`, `src/app/participants/page.tsx`, `src/app/points/page.tsx`, `src/app/insights/page.tsx`, `src/utils/participants.ts`).
- The Manage Trails "My organiser activity" tile now pulls your recently created trails from the backend, surfaces quick stats (created/published/draft/upcoming), and lets you jump straight into a trail from the list (`apps/organizer-dashboard/src/app/manageTrails/page.tsx`, `src/services/trails.ts`).
- Points, Rewards, and Insights now rely solely on the global header organisation selector, removing redundant per-page dropdowns and keeping data in sync (`apps/organizer-dashboard/src/app/points/page.tsx`, `src/app/rewards/page.tsx`, `src/app/insights/page.tsx`).
- Organiser Reports tab now generates real CSV/XLS exports for participation, activity, member directory, and monthly KPI summaries scoped to the selected organisation (`apps/organizer-dashboard/src/app/reports/page.tsx`).
